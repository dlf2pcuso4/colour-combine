<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Colour Combine</title>
    <style>
      * {
        padding: 0;
        margin: 0;
      }
      body {
        background-color: #151515;
      }
    </style>
  </head>
  <body>
    <div
      style="
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      "
    >
      <div style="max-width: min-content">
        <div style="display: flex; justify-content: center">
          <div
            style="
              width: 65px;
              height: 65px;
              margin: 2.5px;
              background-color: #ff0000;
            "
            onclick="colour('#ff0000')"
          ></div>
          <div
            style="
              width: 65px;
              height: 65px;
              margin: 2.5px;
              background-color: #00ff00;
            "
            onclick="colour('#00ff00')"
          ></div>
          <div
            style="
              width: 65px;
              height: 65px;
              margin: 2.5px;
              background-color: #0000ff;
            "
            onclick="colour('#0000ff')"
          ></div>
          <div
            style="
              width: 65px;
              height: 65px;
              margin: 2.5px;
              background-color: #ffffff;
            "
            onclick="colour('#ffffff')"
          ></div>
        </div>
        <canvas></canvas>
      </div>
    </div>
  </body>
  <script>
    var grids = [];
    var ctxcolour = "#00ff00";
    for (let i = 0; i < 10; i++) {
      grids[i] = [];
      for (let j = 0; j < 10; j++) {
        grids[i][j] = "#000000";
      }
    }
    const cnv = document.getElementsByTagName("canvas")[0];
    const ctx = cnv.getContext("2d");
    cnv.width = 705;
    cnv.height = 705;
    const clearCanvas = () => ctx.clearRect(0, 0, cnv.width, cnv.height);
    setInterval(refresh, 100);
    setInterval(advanceWhite, 500);
    setInterval(advanceRed, 300);

    function refresh() {
      for (let i = 0; i < grids.length; i++) {
        for (let j = 0; j < grids[i].length; j++) {
          ctx.fillStyle = grids[i][j];
          ctx.fillRect(70 * i + 5, 70 * j + 5, 65, 65);
        }
      }
    }
    cnv.onclick = function click(event) {
      const rect = cnv.getBoundingClientRect();
      const x = Math.ceil((event.clientX - rect.left) / 70) - 1;
      const y = Math.ceil((event.clientY - rect.top) / 70) - 1;
      if (grids[x][y] == "#000000") {
        grids[x][y] = ctxcolour;
      } else {
        grids[x][y] = "#000000";
      }
    };
    function colour(c) {
      ctxcolour = c;
    }
    function advanceWhite() {
      for (let i = 0; i < grids.length; i++) {
        for (let j = 0; j < grids[i].length; j++) {
          if (grids[i][j] == "#ffffff") {
            grids[i][j] = "#000000";
            if (i > 0) {
              if (grids[i - 1][j] == "#ff0000") {
                grids[i - 1][j] = "#ff8888";
              } else {
                grids[i - 1][j] = "#ffffff";
              }
            }
          }
        }
      }
    }
    function advanceRed() {
      for (let i = grids.length - 1; i >= 0; i--) {
        for (let j = 0; j < grids[i].length; j++) {
          if (grids[i][j] == "#ff0000") {
            grids[i][j] = "#000000";
            if (i < 9) {
              switch (grids[i + 1][j]) {
                case "#0000ff":
                  grids[i + 1][j] = "#ff00ff";
                  if (j > 0) {
                    grids[i + 1][j - 1] = "#ff00ff";
                  }
                  if (j < 9) {
                    grids[i + 1][j + 1] = "#ff00ff";
                  }
                  break;
                case "#ffffff":
                  grids[i][j] = "#ff0000";
                  break;
                default:
                  grids[i + 1][j] = "#ff0000";
              }
            }
          }
        }
      }
    }
  </script>
</html>
